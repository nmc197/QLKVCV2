@{
    ViewData["Title"] = "Trang chủ";
}

<body>
    <header>
        <nav class="navbar navbar-default" role="navigation">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#"><img class="imagePage" src="https://tiniworld.com/wp-content/uploads/2017/10/logotini.png" /></a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse navbar-ex1-collapse">
                <ul class="nav navbar-nav">
                    <li role="presentation"><a href="#home" aria-controls="home" role="tab" data-toggle="tab">Khu vui chơi</a></li>
                    <li role="presentation">
                        <a href="#tab" aria-controls="tab" role="tab" data-toggle="tab">Nhân viên</a>
                    </li>
                    <li role="presentation"> <a href="#game" aria-controls="game" role="tab" data-toggle="tab">Trò chơi</a></li>
                    <li><a href="#service" aria-controls="service" role="tab" data-toggle="tab">Dịch vụ</a></li>
                    <li><a href="#" aria-controls="service" role="tab" data-toggle="tab">Phòng ban</a></li>
                    <li><a href="#" aria-controls="service" role="tab" data-toggle="tab">Người dùng</a></li>
                    <li><a href="#" aria-controls="service" role="tab" data-toggle="tab">Khách hàng</a></li>
                    <li><a href="#" aria-controls="service" role="tab" data-toggle="tab">Hóa đơn</a></li>
                    <li><a href="#" aria-controls="service" role="tab" data-toggle="tab">Quyền</a></li>
                    <li><a href="#" aria-controls="service" role="tab" data-toggle="tab">Vé</a></li>
                    <li><a href="#" aria-controls="service" role="tab" data-toggle="tab">Thiết bị</a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Đăng nhập <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <li><a href="#">Action</a></li>
                            <li><a href="#">Another action</a></li>
                            <li><a href="#">Something else here</a></li>
                            <li><a href="#">Separated link</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </nav>


    </header>
    <div class="bodypage">
        <div class="info">
            <div role="tabpanel" class="parrent-tab">
                <!-- Tab panes -->
                <div class="tab-content">
                    <div role="tabpanel" class="tab-pane active" id="home">
                        <div class="title">
                            <h1>Danh sách khu vui chơi</h1>
                            <button type="button" class="btn btn-success" data-toggle="modal" data-target="#modal-id" onclick="editItem(0)">Tạo mới</button>

                        </div>
                        <table id="tableData" class="display" style="width:100%">
                            <thead>
                                <tr>
                                    <th>STT</th>
                                    <th>Mã khu</th>
                                    <th>Tên khu</th>
                                    <th>Giá trẻ em</th>
                                    <th>Giá người lớn</th>
                                    <th></th>
                                    <th></th>

                                </tr>
                            </thead>
                            <tbody>
                                @*<tr>
                            <td>KVC01</td>
                            <td>Khu công viên nước</td>
                            <td>S1-1</td>
                            <td>9000</td>
                            <td>08:00:00</td>
                            <td>17:00:00</td>
                            <td>80,000 VNĐ</td>
                            <td>100,000 VNĐ</td>
                            <td><a href="#"><i class='fa fa-edit fa-2x' style='color:#03a9f4'></i></a></td>
                            <td><a href="#"><i class='fa fa-trash fa-2x' style='color:#e91e63'></i></a></td>
                        </tr>*@
                            </tbody>
                        </table>
                    </div>
                    <div role="tabpanel" class="tab-pane" id="tab">
                        <div class="title">
                            <h1>Danh sách nhân viên</h1>
                            <button type="button" class="btn btn-success" data-toggle="modal" data-target="#modal-id-NhanVien" onclick="editItemNhanVien(0)">Tạo mới</button>

                        </div>
                        <table id="tableDataNhanVien" class="display" style="width:100%">
                            <thead>
                                <tr>
                                    <th>STT</th>
                                    <th>Mã NV</th>
                                    <th>Tên NV</th>
                                    <th>Ngày sinh</th>
                                    <th>Giới tính</th>
                                    <th>Mã khu phụ trách</th>
                                    <th>Mã phòng ban</th>
                                    <th>Lương</th>
                                    <th>Quê quán</th>
                                    <th></th>
                                    <th></th>

                                </tr>
                            </thead>
                            <tbody>
                                @*<tr>
                            <td>KVC01</td>
                            <td>Khu công viên nước</td>
                            <td>S1-1</td>
                            <td>9000</td>
                            <td>08:00:00</td>
                            <td>17:00:00</td>
                            <td>80,000 VNĐ</td>
                            <td>100,000 VNĐ</td>
                            <td><a href="#"><i class='fa fa-edit fa-2x' style='color:#03a9f4'></i></a></td>
                            <td><a href="#"><i class='fa fa-trash fa-2x' style='color:#e91e63'></i></a></td>
                        </tr>*@
                            </tbody>
                        </table>
                    </div>
                    <div role="tabpanel" class="tab-pane" id="game">
                        <div class="title">
                            <h1>Danh sách trò chơi</h1>
                            <button type="button" class="btn btn-success" data-toggle="modal" data-target="#modal-id-NhanVien" onclick="editItemNhanVien(0)">Tạo mới</button>

                        </div>
                        <table id="tableDataTroChoi" class="display" style="width:100%">
                            <thead>
                                <tr>
                                    <th>STT</th>
                                    <th>Mã trò chơi</th>
                                    <th>Tên trò chơi</th>
                                    <th>Mã nhân viên</th>
                                    <th>Số lượng người chơi</th>
                                    <th>Mã khu</th>
                                    <th></th>
                                    <th></th>

                                </tr>
                            </thead>
                            <tbody>
                                @*<tr>
                            <td>KVC01</td>
                            <td>Khu công viên nước</td>
                            <td>S1-1</td>
                            <td>9000</td>
                            <td>08:00:00</td>
                            <td>17:00:00</td>
                            <td>80,000 VNĐ</td>
                            <td>100,000 VNĐ</td>
                            <td><a href="#"><i class='fa fa-edit fa-2x' style='color:#03a9f4'></i></a></td>
                            <td><a href="#"><i class='fa fa-trash fa-2x' style='color:#e91e63'></i></a></td>
                        </tr>*@
                            </tbody>
                        </table>
                    </div>

                    <div role="tabpanel" class="tab-pane" id="service">
                        <div class="title">
                            <h1>Danh sách dịch vụ</h1>
                            <button type="button" class="btn btn-success" data-toggle="modal" data-target="#modal-id-NhanVien" onclick="editItemNhanVien(0)">Tạo mới</button>

                        </div>
                        <table id="tableDataNhanVien" class="display" style="width:100%">
                            <thead>
                                <tr>
                                    <th>STT</th>
                                    <th>Mã NV</th>
                                    <th>Tên NV</th>
                                    <th>Ngày sinh</th>
                                    <th>Giới tính</th>
                                    <th>Mã khu phụ trách</th>
                                    <th>Mã phòng ban</th>
                                    <th>Lương</th>
                                    <th>Quê quán</th>
                                    <th></th>
                                    <th></th>

                                </tr>
                            </thead>
                            <tbody>
                                @*<tr>
                            <td>KVC01</td>
                            <td>Khu công viên nước</td>
                            <td>S1-1</td>
                            <td>9000</td>
                            <td>08:00:00</td>
                            <td>17:00:00</td>
                            <td>80,000 VNĐ</td>
                            <td>100,000 VNĐ</td>
                            <td><a href="#"><i class='fa fa-edit fa-2x' style='color:#03a9f4'></i></a></td>
                            <td><a href="#"><i class='fa fa-trash fa-2x' style='color:#e91e63'></i></a></td>
                        </tr>*@
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="modal fade" id="modal-id" role="dialog">
                    <div class="modal-dialog">

                        <!-- Modal content-->
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                @*<h4 class="modal-title">Modal Header</h4>*@
                            </div>
                            <div class="modal-body">
                                <form action="" method="POST"
                                      onsubmit='updateItem(updatingItemID); return false;' role="form">
                                    <div class="form-group col-sm-6">
                                        <label for="">Mã khu</label>
                                        <input type="text" class="form-control input-id"
                                               id="maKhu"
                                               placeholder="">
                                    </div>
                                    <div class='form-group col-sm-6'>
                                        <label class=''>MãNVQL</label>
                                        <input type="text" class="form-control input-id"
                                               id="maNVQL"
                                               placeholder="">
                                    </div>
                                    <div class="form-group col-sm-12">
                                        <label for="">Tên khu</label>
                                        <input type="text" class="form-control input-id"
                                               id="tenKhu"
                                               placeholder="">
                                    </div>
                                    <div class='form-group col-sm-6'>
                                        <label class=''>Giá trẻ em</label>
                                        <input type="number" class="form-control input-id"
                                               id="giaVeTreEm"
                                               placeholder="">
                                    </div>
                                    <div class='form-group col-sm-6'>
                                        <label class=''>Giá người lớn</label>
                                        <input type="number" class="form-control input-id"
                                               id="giaVeNguoiLon"
                                               placeholder="">
                                    </div>
                                    <input style="display:none" id="hiddenSubmit" type="submit"
                                           class="btn btn-default" value="Save changes">
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default"
                                        data-dismiss="modal">
                                    Close
                                </button>
                                <button type="button" class="btn btn-primary" id="btnUpdateItem"
                                        onclick="document.getElementById('hiddenSubmit').click();">
                                    Save
                                    changes
                                </button>
                            </div>
                        </div>

                    </div>
                </div>
                <div class="modal fade" id="modal-id-NhanVien" role="dialog">
                    <div class="modal-dialog">

                        <!-- Modal content-->
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                @*<h4 class="modal-title">Modal Header</h4>*@
                            </div>
                            <div class="modal-body">
                                <form action="" method="POST"
                                      onsubmit='updateItemNhanVien(updatingItemID); return false;' role="form">
                                    <div class="form-group col-sm-6">
                                        <label for="">Mã NV</label>
                                        <input type="text" class="form-control input-id"
                                               id="maNv"
                                               placeholder="">
                                    </div>
                                    <div class='form-group col-sm-6'>
                                        <label class=''>Tên NV</label>
                                        <input type="text" class="form-control input-id"
                                               id="tenNv"
                                               placeholder="">
                                    </div>
                                    <div class='form-group'>
                                        <label for=''>Ngày sinh </label><span class='required'>*</span>
                                        <div class='input-group date datetimepicker  input-ngaySinh' id='ngaySinh'>
                                            <input type='text' id="ngaySinh" required class="form-control" />
                                            <span class="input-group-addon">
                                                <span class="glyphicon glyphicon-calendar"></span>
                                            </span>
                                        </div>
                                    </div>
                                    <div class='form-group col-sm-6'>
                                        <label class=''>Giới tính</label>
                                        <select>
                                            <option value="0">Nam</option>
                                            <option value="1">Nữ</option>
                                        </select>
                                    </div>
                                    <div class='form-group col-sm-6'>
                                        <label class=''>Mã khu phụ trách</label>
                                        <input type="text" class="form-control input-id"
                                               id="maKhu"
                                               placeholder="">
                                    </div>
                                    <div class='form-group col-sm-6'>
                                        <label class=''>Quê quán</label>
                                        <input type="text" class="form-control input-id"
                                               id="queQuan"
                                               placeholder="">
                                    </div>
                                    <div class='form-group col-sm-6'>
                                        <label class=''>Lương</label>
                                        <input type="text" class="form-control input-id"
                                               id="luong"
                                               placeholder="">
                                    </div>
                                    <div class='form-group col-sm-6'>
                                        <label class=''>Mã phòng ban</label>
                                        <input type="text" class="form-control input-id"
                                               id="maPb"
                                               placeholder="">
                                    </div>
                                    <input style="display:none" id="hiddenSubmitNhanVien" type="submit"
                                           class="btn btn-default" value="Save changes">
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default"
                                        data-dismiss="modal">
                                    Close
                                </button>
                                <button type="button" class="btn btn-primary" id="btnUpdateItem"
                                        onclick="document.getElementById('hiddenSubmitNhanVien').click();">
                                    Save
                                    changes
                                </button>
                            </div>
                        </div>

                    </div>
                </div>

                <div class="modal fade" id="modal-id-TroChoi" role="dialog">
                    <div class="modal-dialog">

                        <!-- Modal content-->
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                @*<h4 class="modal-title">Modal Header</h4>*@
                            </div>
                            <div class="modal-body">
                                <form action="" method="POST"
                                      onsubmit='updateItemTroChoi(updatingItemID); return false;' role="form">
                                    <div class="form-group col-sm-6">
                                        <label for="">Mã trò chơi</label>
                                        <input type="text" class="form-control input-id"
                                               id="maTroChoi"
                                               placeholder="">
                                    </div>
                                    <div class='form-group col-sm-6'>
                                        <label class=''>Tên trò chơi</label>
                                        <input type="text" class="form-control input-id"
                                               id="tenTroChoi"
                                               placeholder="">
                                    </div>
                                    <div class='form-group col-sm-6'>
                                        <label class=''>Mã NV phụ trách</label>
                                        <input type="text" class="form-control input-id"
                                               id="maNVPhuTrach"
                                               placeholder="">
                                    </div>
                                    <div class='form-group col-sm-6'>
                                        <label class=''>Số lượng người chơi</label>
                                        <input type="text" class="form-control input-id"
                                               id="soLuongNguoiChoiMax"
                                               placeholder="">
                                    </div>
                                    <div class='form-group col-sm-6'>
                                        <label class=''>Mã khu</label>
                                        <input type="text" class="form-control input-id"
                                               id="maKhu"
                                               placeholder="">
                                    </div>
                                    <input style="display:none" id="hiddenSubmitTroChoi" type="submit"
                                           class="btn btn-default" value="Save changes">
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default"
                                        data-dismiss="modal">
                                    Close
                                </button>
                                <button type="button" class="btn btn-primary" id="btnUpdateItemTroChoi"
                                        onclick="document.getElementById('hiddenSubmitTroChoi').click();">
                                    Save
                                    changes
                                </button>
                            </div>
                        </div>

                    </div>
                </div>


            </div>

        </div>


    </div>




</body>

<script>
    $(document).ready(function () {
        setTimeout(function () { loadData(); }, 460);
        setTimeout(function () { loadDataNhanVien(); }, 560);
        setTimeout(function () { loadDataTroChoi(); }, 660);

    });
</script>

<script>
    var showItems = ["maKhu", "tenKhu", "mANVQL", "giaVeTreEm", "giaVeNguoiLon"];

    var dataSource = [];
    var updatingItemId = 0;
    var tableUpdating = 0;
    var table;
    var systemURL = "https://localhost:44350/";
    function loadData() {
        $.ajax({
            url: systemURL + "khutrochoi/api/list",
            type: "GET",
            contentType: "application/json",
            success: function (responseData) {
                debugger;
                var data = responseData.data;
                dataSource = data;
                data.forEach(function (item, index) {
                    // console.log(item, index);
                    var rowContent = "";
                    rowContent += "<td style='text-align: center;'>" + (index + 1) + "</td>";
                    for (var key in item) {
                        if (item.hasOwnProperty(key)) {
                            // console.log(key + " -> " + item[key]);
                            if (showItems.includes(key)) {
                                if (key == "photo") {
                                    rowContent += "<td class='row" + item.maKhu + "-column column-" + key + "' property='" + key + "'><span style='color:red'><i class='fa fa-times' aria-hidden='true' style='font-size:1.5em'></i></span></td>";

                                }
                                else {
                                    rowContent += "<td class='row" + item.maKhu + "-column column-" + key + "' property='" + key + "'>" + item[key] + "</td>";
                                }
                            }
                        }
                    }
                    rowContent += '<td style="text-align: center;"><a onclick="editItem(\'' + item.maKhu + '\')"><i class="fa fa-edit fa-2x" style="color:#03a9f4"></i></a></td>';
                    rowContent += '<td style="text-align: center;"><a onclick="deleteItem(\'' + item.maKhu + '\')"><i class="fa fa-trash fa-2x" style ="color:#e91e63"></i></a></td>';

                    var newRow = "<tr id='row" + item.maKhu + "' >" + rowContent + "</tr>";
                    $(newRow).appendTo($("#tableData tbody"));

                    // $("#tableData #dummyRow").after("<tr id='row"+item.id+"' >" + rowContent + "</tr>");
                });

                //Init datatable
                if (tableUpdating === 0) {
                    initTablePage();
                }

                //update data with foreign key
                updateTable();
            },
            error: function (e) {
                //console.log(e.message);
                initTablePage();
            }
        });
    }

    function initTablePage() {
        table = $('#tableData').DataTable({
            aLengthMenu: [
                [-1, 10, 25, 50, 100, 200],
                ['Tất cả', 10, 25, 50, 100, 200]
            ],
            'order': [
                [1, 'desc']
            ],
            "oLanguage": {
                "sUrl": "/js/Vietnamese.json"
            },
            "initComplete": function (settings, json) {
                table.on('order.dt search.dt', function () {
                    table.column(0, {
                        search: 'applied',
                        order: 'applied'
                    }).nodes().each(function (cell, i) {
                        cell.innerHTML = i + 1;
                    });
                }).draw();

                $('#tableData tfoot th').each(function () {
                    var title = $(this).text();
                    $(this).html("<input type='text' class='tableFooterFilter' placeholder=' ' />");
                });

                table.columns().every(function () {
                    var that = this;
                    $('input.tableFooterFilter', this.footer()).on('keyup change', function () {
                        if (that.search() !== this.value) {
                            that.search(this.value).draw();
                        }
                    });
                });
            }
        });

        setTimeout(function () {
            table.page.len(18).draw();
        }, 1000);
    }
    $(".btn.btn-success").click(function () {
        $(".modal-body").toggle("show");
    });
    function editItem(id) {
        debugger;
        updatingItemID = id;
        if (id != "") {
            $("#modal-id").modal('show');
        }
        //$("#modal-id").modal('show');
        let obj = getItemByID(id);
        $("#maKhu").val(id != "" ? obj.maKhu : "");
        $("#maNVQL").val(id != "" ? obj.maNvql : "");
        $("#tenKhu").val(id != "" ? obj.tenKhu : "");
        $("#giaVeTreEm").val(id != "" ? obj.giaVeTreEm : "");
        $("#giaVeNguoiLon").val(id != "" ? obj.giaVeNguoiLon : "");
        //formatNumber();
    }
    function updateItem(id) {
        debugger;
        var actionName = (id == 0 ? "Bạn muốn tạo mới" : "Cập nhật");
        let obj = getItemByID(id);
        let objName = id > 0 ? obj.name : "item";

        //validateInputNumber();

        // "id": $("#topicId").val(),
        // "name": $("#topicName").val(),
        // "description": $("#topicDescription").val(),
        // "createdTime": $("#topicCreatedTime").val(),
        // "active": $("#topicActive").val()
        var updatingObj = {
            "maKhu": $("#maKhu").val(),
            "maNVQL": $("#maNVQL").val(),
            "tenKhu": $("#tenKhu").val(),
            "giaVeTreEm": $("#giaVeTreEm").val(),
            "giaVeNguoiLon": $("#giaVeNguoiLon").val(),
        };

        // correcting data
        //updatingObj.provinceID = updatingObj.provinceID.join(", ");

        Swal.fire({
            title: 'Xác nhận thay đổi?',
            text: "" + actionName + " \"" + objName + "\"",
            icon: 'info',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#443',
            confirmButtonText: 'Xác nhận',
            cancelButtonText: 'Huỷ'
        }).then((result) => {
            if (result.value) {
                $("#modal-id").modal('hide');

                //CALL AJAX TO UPDATE
                if (id > 0) {
                    $.ajax({
                        url: systemURL + "khutrochoi/api/update",
                        type: "POST",
                        contentType: "application/json",
                        data: JSON.stringify(updatingObj),
                        success: function (responseData) {
                            // debugger;
                            if (responseData.status == 200 && responseData.message === "SUCCESS") {
                                Swal.fire(
                                    'Thành Công!',
                                    'Đã cập nhật \"' + objName + '\" ',
                                    'success'
                                );
                                updateTable(id, updatingObj, "update");
                                var updatedItemIndex = dataSource.findIndex(item => parseInt(item.id) === id);
                                dataSource[updatedItemIndex] = updatingObj;
                            }
                        },
                        error: function (e) {
                            //console.log(e.message);
                            Swal.fire(
                                'Lỗi!',
                                'Đã xảy ra lỗi, vui lòng thử lại',
                                'error'
                            );
                        }
                    });
                };

                //CALL AJAX TO CREATE
                if (id == 0) {
                    updatingObj.id = 1;
                    console.log(updatingObj);
                    $.ajax({
                        url: systemURL + "khutrochoi/api/add",
                        type: "POST",
                        contentType: "application/json",
                        data: JSON.stringify(updatingObj),
                        success: function (responseData) {
                            // debugger;
                            if (responseData.status == 201 && responseData.message === "CREATED") {
                                Swal.fire(
                                    'Thành công!',
                                    'Đã cập nhật dữ liệu',
                                    'success'
                                );
                                updatingObj = responseData.data;
                                dataSource.push(updatingObj);
                                updateTable(0, updatingObj, "add");
                            }
                        },
                        error: function (e) {
                            //console.log(e.message);
                            Swal.fire(
                                'Lỗi!',
                                'Đã xảy ra lỗi, vui lòng thử lại',
                                'error'
                            );
                        }
                    });
                }
            }
        })
    }
    function getItemByID(id) {
        const result = dataSource.find(item => item.maKhu === id);
        return result;
    }
    function updateTable(id, obj, action) {
        if (action === "delete") {
            table.row("#row" + id).remove().draw();
        }

        if (action === "add") {
            console.log("Added:" + obj);

            //var addedItems = [obj];
            var addedItems = obj;
            var addedValues = [];


            addedItems.forEach(function (item, index) {
                // console.log(item, index);
                var rowContent = "";
                addedValues.push("<td style='text-align: center;'></td>");
                for (var key in item) {
                    if (item.hasOwnProperty(key)) {
                        // console.log(key + " -> " + item[key]);
                        if (!hiddenItem.includes(key)) {
                            addedValues.push("<td class='row" + item.id + "-column column-" + key + "' property='" + key + "'>" + item[key] + "</td>");
                        }
                    }
                }

                addedValues.push("<td style='text-align: center;'><a href='/postTopic/admin/list/" + item.id + "'><i class='fa fa-list fa-2x' style='color:#03a9f4'></i></a></td>");
                addedValues.push("<td style='text-align: center;'><a onclick='editItem(" + item.id + ")'><i class='fa fa-edit fa-2x' style='color:#03a9f4'></i></a></td>");
                addedValues.push("<td style='text-align: center;'><a onclick='deleteItem(" + item.id + ")'><i class='fa fa-trash fa-2x' style='color:#e91e63'></i></a></td>");

                table.row.add(addedValues).draw();
            });
            // location.reload();
        }

        if (action === "update") {
            // alert(id);
            $(".row" + id + "-column").each(function () {
                var propertyName = $(this).attr("property");
                console.log(propertyName);

                for (var key in obj) {
                    if (key === propertyName && obj.hasOwnProperty(key)) {
                        this.innerText = obj[key];
                    }
                }

            });
        }

        //Update columns with foreign key
        // var NO_FKFKUpdateSelector = 'tr';
        // if( !(typeof(id) === 'undefined')) {
        //     NO_FKFKUpdateSelector = '#row'+id;
        // }
        // $('#tableData tbody '+NO_FKFKUpdateSelector+' td[property=NO_FKID]').each(function(){
        //     // debugger;
        //     var topicID = parseInt($(this).attr('class').replace('row','').replace('-column',''));
        //     var topicObj = getItemByID(topicID);
        //     var NO_FKID = parseInt(topicObj.NO_FKID);
        //     var NO_FKObj = NO_FKData.find(item => parseInt(item.id) === NO_FKID);
        //     $(this).text(NO_FKObj.name);
        //     // console.log('FK updated for Staff '+topicID);
        // });


        //formatNumber();
    }
    function deleteItem(id) {
        debugger;
        let obj = getItemByID(id);
        Swal.fire({
            title: 'Xác nhận thay đổi?',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#3085d6',
            confirmButtonText: 'Xoá',
            cancelButtonText: 'Huỷ'
        }).then((result) => {
            if (result.value) {

                //CALL AJAX TO DELETE
                $.ajax({
                    url: systemURL + "KhuTroChoi/api/delete",
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify({ "maKhu": id }),
                    success: function (responseData) {
                        debugger;
                        if (responseData.status == 200 && responseData.message === "SUCCESS") {
                            Swal.fire(
                                'Thành công!',
                                'success'
                            );
                            window.location.reload();
                        }
                    },
                    error: function (e) {
                        //console.log(e.message);
                        Swal.fire(
                            'Lỗi!',
                            'Đã xảy ra lỗi, vui lòng thử lại',
                            'error'
                        );
                    }
                });

            }
        })
    }
</script>

<script>
    var showItemsNhanVien = ["maNv", "tenNv", "ngaySinh", "gioiTinh", "maKhuPhuTrach","maPb","luong","queQuan"];

    var dataSourceNhanVien = [];
    var updatingItemIdNhanVien = 0;
    var tableUpdatingNhanVien = 0;
    var tableNhanVien;
    var systemURL = "https://localhost:44350/";
    function loadDataNhanVien() {
        $.ajax({
            url: systemURL + "nhanvien/api/list",
            type: "GET",
            contentType: "application/json",
            success: function (responseData) {
                debugger;
                var data = responseData.data;
                dataSourceNhanVien = data;
                data.forEach(function (item, index) {
                    // console.log(item, index);
                    var rowContent = "";
                    rowContent += "<td style='text-align: center;'>" + (index + 1) + "</td>";
                    for (var key in item) {
                        if (item.hasOwnProperty(key)) {
                            // console.log(key + " -> " + item[key]);
                            if (showItemsNhanVien.includes(key)) {
                                if (key == "photo") {
                                    rowContent += "<td class='row" + item.maNv + "-column column-" + key + "' property='" + key + "'><span style='color:red'><i class='fa fa-times' aria-hidden='true' style='font-size:1.5em'></i></span></td>";

                                }
                                else {
                                    rowContent += "<td class='row" + item.maNv + "-column column-" + key + "' property='" + key + "'>" + item[key] + "</td>";
                                }
                            }
                        }
                    }
                    rowContent += '<td style="text-align: center;"><a onclick="editItem(\'' + item.maNv + '\')"><i class="fa fa-edit fa-2x" style="color:#03a9f4"></i></a></td>';
                    rowContent += '<td style="text-align: center;"><a onclick="deleteItem(\'' + item.maNv + '\')"><i class="fa fa-trash fa-2x" style ="color:#e91e63"></i></a></td>';

                    var newRow = "<tr id='row" + item.maNv + "' >" + rowContent + "</tr>";
                    $(newRow).appendTo($("#tableDataNhanVien tbody"));

                    // $("#tableData #dummyRow").after("<tr id='row"+item.id+"' >" + rowContent + "</tr>");
                });

                //Init datatable
                if (tableUpdatingNhanVien === 0) {
                    initTablePageNhanVien();
                }

                //update data with foreign key
            },
            error: function (e) {
                //console.log(e.message);
                initTablePageNhanVien();
            }
        });
    }
    function initTablePageNhanVien() {
        tableNhanVien = $('#tableDataNhanVien').DataTable({
            aLengthMenu: [
                [-1, 10, 25, 50, 100, 200],
                ['Tất cả', 10, 25, 50, 100, 200]
            ],
            'order': [
                [1, 'desc']
            ],
            "oLanguage": {
                "sUrl": "/js/Vietnamese.json"
            },
            "initComplete": function (settings, json) {
                tableNhanVien.on('order.dt search.dt', function () {
                    tableNhanVien.column(0, {
                        search: 'applied',
                        order: 'applied'
                    }).nodes().each(function (cell, i) {
                        cell.innerHTML = i + 1;
                    });
                }).draw();

                $('#tableDataNhanVien tfoot th').each(function () {
                    var title = $(this).text();
                    $(this).html("<input type='text' class='tableFooterFilter' placeholder=' ' />");
                });

                tableNhanVien.columns().every(function () {
                    var that = this;
                    $('input.tableFooterFilter', this.footer()).on('keyup change', function () {
                        if (that.search() !== this.value) {
                            that.search(this.value).draw();
                        }
                    });
                });
            }
        });

        setTimeout(function () {
            tableNhanVien.page.len(18).draw();
        }, 1000);
    }
    function editItemNhanVien(id) {
        debugger;
        updatingItemID = id;
        if (id != "") {
            $("#modal-id-NhanVien").modal('show');
        }
        //$("#modal-id").modal('show');
        let obj = getItemByIDNhanVien(id);
        $("#maNv").val(id != "" ? obj.maNv : "");
        $("#tenNv").val(id != "" ? obj.tenNv : "");
        $("#gioiTinh").val(id != "" ? obj.gioiTinh : "");
        $("#ngaySinh").val(id != "" ? obj.ngaySinh : "");
        $("#maKhuPhuTrach").val(id != "" ? obj.maKhuPhuTrach : "");
        $("#maPB").val(id != "" ? obj.maPb : "");
        $("#luong").val(id != "" ? obj.luong : "");
        $("#queQuan").val(id != "" ? obj.queQuan : "");


        //formatNumber();
    }
    function updateItemNhanVien(id) {
        debugger;
        var actionName = (id == 0 ? "Bạn muốn tạo mới" : "Cập nhật");
        let obj = getItemByIDNhanVien(id);
        let objName = id > 0 ? obj.name : "item";

        //validateInputNumber();

        // "id": $("#topicId").val(),
        // "name": $("#topicName").val(),
        // "description": $("#topicDescription").val(),
        // "createdTime": $("#topicCreatedTime").val(),
        // "active": $("#topicActive").val()
        var updatingObj = {
            "maNV": $("#maNV").val(),
            "tenNV": $("#tenNV").val(),
            "ngaySinh": $("#ngaySinh").val(),
            "gioiTinh": $("#gioiTinh").val(),
            "maKhuPhuTrach": $("#maKhuPhuTrach").val(),
            "maPB": $("#maPB").val(),
            "luong": $("#luong").val(),
            "queQuan": $("#queQuan").val(),
        };

        // correcting data
        //updatingObj.provinceID = updatingObj.provinceID.join(", ");

        Swal.fire({
            title: 'Xác nhận thay đổi?',
            text: "" + actionName + " \"" + objName + "\"",
            icon: 'info',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#443',
            confirmButtonText: 'Xác nhận',
            cancelButtonText: 'Huỷ'
        }).then((result) => {
            if (result.value) {
                $("#modal-id").modal('hide');

                //CALL AJAX TO UPDATE
                if (id > 0) {
                    $.ajax({
                        url: systemURL + "nhanvien/api/update",
                        type: "POST",
                        contentType: "application/json",
                        data: JSON.stringify(updatingObj),
                        success: function (responseData) {
                            // debugger;
                            if (responseData.status == 200 && responseData.message === "SUCCESS") {
                                Swal.fire(
                                    'Thành Công!',
                                    'Đã cập nhật \"' + objName + '\" ',
                                    'success'
                                );
                                updateTableNhanVien(id, updatingObj, "update");
                                var updatedItemIndex = dataSource.findIndex(item => parseInt(item.id) === id);
                                dataSource[updatedItemIndex] = updatingObj;
                            }
                        },
                        error: function (e) {
                            //console.log(e.message);
                            Swal.fire(
                                'Lỗi!',
                                'Đã xảy ra lỗi, vui lòng thử lại',
                                'error'
                            );
                        }
                    });
                };

                //CALL AJAX TO CREATE
                if (id == 0) {
                    updatingObj.id = 1;
                    console.log(updatingObj);
                    $.ajax({
                        url: systemURL + "nhanvien/api/add",
                        type: "POST",
                        contentType: "application/json",
                        data: JSON.stringify(updatingObj),
                        success: function (responseData) {
                            // debugger;
                            if (responseData.status == 201 && responseData.message === "CREATED") {
                                Swal.fire(
                                    'Thành công!',
                                    'Đã cập nhật dữ liệu',
                                    'success'
                                );
                                updatingObj = responseData.data;
                                dataSourceNhanVien.push(updatingObj);
                                updateTableNhanVien(0, updatingObj, "add");
                            }
                        },
                        error: function (e) {
                            //console.log(e.message);
                            Swal.fire(
                                'Lỗi!',
                                'Đã xảy ra lỗi, vui lòng thử lại',
                                'error'
                            );
                        }
                    });
                }
            }
        })
    }
    function getItemByIDNhanVien(id) {
        const result = dataSource.find(item => item.maNv === id);
        return result;
    }
    function updateTableNhanVien(id, obj, action) {
        if (action === "delete") {
            table.row("#row" + id).remove().draw();
        }

        if (action === "add") {
            console.log("Added:" + obj);

            //var addedItems = [obj];
            var addedItems = obj;
            var addedValues = [];


            addedItems.forEach(function (item, index) {
                // console.log(item, index);
                var rowContent = "";
                addedValues.push("<td style='text-align: center;'></td>");
                for (var key in item) {
                    if (item.hasOwnProperty(key)) {
                        // console.log(key + " -> " + item[key]);
                        if (!hiddenItem.includes(key)) {
                            addedValues.push("<td class='row" + item.id + "-column column-" + key + "' property='" + key + "'>" + item[key] + "</td>");
                        }
                    }
                }

                addedValues.push("<td style='text-align: center;'><a href='/postTopic/admin/list/" + item.id + "'><i class='fa fa-list fa-2x' style='color:#03a9f4'></i></a></td>");
                addedValues.push("<td style='text-align: center;'><a onclick='editItem(" + item.id + ")'><i class='fa fa-edit fa-2x' style='color:#03a9f4'></i></a></td>");
                addedValues.push("<td style='text-align: center;'><a onclick='deleteItem(" + item.id + ")'><i class='fa fa-trash fa-2x' style='color:#e91e63'></i></a></td>");

                table.row.add(addedValues).draw();
            });
            // location.reload();
        }

        if (action === "update") {
            // alert(id);
            $(".row" + id + "-column").each(function () {
                var propertyName = $(this).attr("property");
                console.log(propertyName);

                for (var key in obj) {
                    if (key === propertyName && obj.hasOwnProperty(key)) {
                        this.innerText = obj[key];
                    }
                }

            });
        }

        //Update columns with foreign key
        // var NO_FKFKUpdateSelector = 'tr';
        // if( !(typeof(id) === 'undefined')) {
        //     NO_FKFKUpdateSelector = '#row'+id;
        // }
        // $('#tableData tbody '+NO_FKFKUpdateSelector+' td[property=NO_FKID]').each(function(){
        //     // debugger;
        //     var topicID = parseInt($(this).attr('class').replace('row','').replace('-column',''));
        //     var topicObj = getItemByID(topicID);
        //     var NO_FKID = parseInt(topicObj.NO_FKID);
        //     var NO_FKObj = NO_FKData.find(item => parseInt(item.id) === NO_FKID);
        //     $(this).text(NO_FKObj.name);
        //     // console.log('FK updated for Staff '+topicID);
        // });


        //formatNumber();
    }
    function deleteItemNhanVien(id) {
        debugger;
        let obj = getItemByIDNhanVien(id);
        Swal.fire({
            title: 'Xác nhận thay đổi?',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#3085d6',
            confirmButtonText: 'Xoá',
            cancelButtonText: 'Huỷ'
        }).then((result) => {
            if (result.value) {

                //CALL AJAX TO DELETE
                $.ajax({
                    url: systemURL + "nhanvien/api/delete",
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify({ "maKhu": id }),
                    success: function (responseData) {
                        debugger;
                        if (responseData.status == 200 && responseData.message === "SUCCESS") {
                            Swal.fire(
                                'Thành công!',
                                'success'
                            );
                            window.location.reload();
                        }
                    },
                    error: function (e) {
                        //console.log(e.message);
                        Swal.fire(
                            'Lỗi!',
                            'Đã xảy ra lỗi, vui lòng thử lại',
                            'error'
                        );
                    }
                });

            }
        })
    }


</script>


<script>
    var showItemsTroChoi = ["maTroChoi", "tenTroChoi", "maNVPhuTrach", "soLuongNguoiChoiMax", "maKhu"];

    var dataSourceTroChoi = [];
    var updatingItemIdTroChoi = 0;
    var tableUpdatingN = 0;
    var tableTroChoi;
    var systemURL = "https://localhost:44350/";
    function loadDataTroChoi() {
        $.ajax({
            url: systemURL + "TroChoi/api/list",
            type: "GET",
            contentType: "application/json",
            success: function (responseData) {
                debugger;
                var data = responseData.data;
                dataSourceTroChoi = data;
                data.forEach(function (item, index) {
                    // console.log(item, index);
                    var rowContent = "";
                    rowContent += "<td style='text-align: center;'>" + (index + 1) + "</td>";
                    for (var key in item) {
                        if (item.hasOwnProperty(key)) {
                            // console.log(key + " -> " + item[key]);
                            if (showItemsTroChoi.includes(key)) {
                                if (key == "photo") {
                                    rowContent += "<td class='row" + item.maNv + "-column column-" + key + "' property='" + key + "'><span style='color:red'><i class='fa fa-times' aria-hidden='true' style='font-size:1.5em'></i></span></td>";

                                }
                                else {
                                    rowContent += "<td class='row" + item.maNv + "-column column-" + key + "' property='" + key + "'>" + item[key] + "</td>";
                                }
                            }
                        }
                    }
                    rowContent += '<td style="text-align: center;"><a onclick="editItem(\'' + item.maNv + '\')"><i class="fa fa-edit fa-2x" style="color:#03a9f4"></i></a></td>';
                    rowContent += '<td style="text-align: center;"><a onclick="deleteItem(\'' + item.maNv + '\')"><i class="fa fa-trash fa-2x" style ="color:#e91e63"></i></a></td>';

                    var newRow = "<tr id='row" + item.maNv + "' >" + rowContent + "</tr>";
                    $(newRow).appendTo($("#tableDataTroChoi tbody"));

                    // $("#tableData #dummyRow").after("<tr id='row"+item.id+"' >" + rowContent + "</tr>");
                });

                //Init datatable
                if (tableUpdatingTroChoi === 0) {
                    initTablePageTroChoi();
                }

                //update data with foreign key
            },
            error: function (e) {
                //console.log(e.message);
                initTablePageTroChoi();
            }
        });
    }
    function initTablePageTroChoi() {
        tableTroChoi = $('#tableDataTroChoi').DataTable({
            aLengthMenu: [
                [-1, 10, 25, 50, 100, 200],
                ['Tất cả', 10, 25, 50, 100, 200]
            ],
            'order': [
                [1, 'desc']
            ],
            "oLanguage": {
                "sUrl": "/js/Vietnamese.json"
            },
            "initComplete": function (settings, json) {
                tableTroChoi.on('order.dt search.dt', function () {
                    tableTroChoi.column(0, {
                        search: 'applied',
                        order: 'applied'
                    }).nodes().each(function (cell, i) {
                        cell.innerHTML = i + 1;
                    });
                }).draw();

                $('#tableDataTroChoi tfoot th').each(function () {
                    var title = $(this).text();
                    $(this).html("<input type='text' class='tableFooterFilter' placeholder=' ' />");
                });

                tableTroChoi.columns().every(function () {
                    var that = this;
                    $('input.tableFooterFilter', this.footer()).on('keyup change', function () {
                        if (that.search() !== this.value) {
                            that.search(this.value).draw();
                        }
                    });
                });
            }
        });

        setTimeout(function () {
            tableTroChoi.page.len(18).draw();
        }, 1000);
    }
    function editItemTroChoi(id) {
        debugger;
        updatingItemID = id;
        if (id != "") {
            $("#modal-id-TroChoi").modal('show');
        }
        //$("#modal-id").modal('show');
        let obj = getItemByIDTroChoi(id);
        $("#maNv").val(id != "" ? obj.maNv : "");
        $("#tenNv").val(id != "" ? obj.tenNv : "");
        $("#gioiTinh").val(id != "" ? obj.gioiTinh : "");
        $("#ngaySinh").val(id != "" ? obj.ngaySinh : "");
        $("#maKhuPhuTrach").val(id != "" ? obj.maKhuPhuTrach : "");
        $("#maPB").val(id != "" ? obj.maPb : "");
        $("#luong").val(id != "" ? obj.luong : "");
        $("#queQuan").val(id != "" ? obj.queQuan : "");


        //formatNumber();
    }
    function updateItemTroChoi(id) {
        debugger;
        var actionName = (id == 0 ? "Bạn muốn tạo mới" : "Cập nhật");
        let obj = getItemByIDTroChoi(id);
        let objName = id > 0 ? obj.name : "item";

        //validateInputNumber();

        // "id": $("#topicId").val(),
        // "name": $("#topicName").val(),
        // "description": $("#topicDescription").val(),
        // "createdTime": $("#topicCreatedTime").val(),
        // "active": $("#topicActive").val()
        var updatingObj = {
            "maNV": $("#maNV").val(),
            "tenNV": $("#tenNV").val(),
            "ngaySinh": $("#ngaySinh").val(),
            "gioiTinh": $("#gioiTinh").val(),
            "maKhuPhuTrach": $("#maKhuPhuTrach").val(),
            "maPB": $("#maPB").val(),
            "luong": $("#luong").val(),
            "queQuan": $("#queQuan").val(),
        };

        // correcting data
        //updatingObj.provinceID = updatingObj.provinceID.join(", ");

        Swal.fire({
            title: 'Xác nhận thay đổi?',
            text: "" + actionName + " \"" + objName + "\"",
            icon: 'info',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#443',
            confirmButtonText: 'Xác nhận',
            cancelButtonText: 'Huỷ'
        }).then((result) => {
            if (result.value) {
                $("#modal-id").modal('hide');

                //CALL AJAX TO UPDATE
                if (id > 0) {
                    $.ajax({
                        url: systemURL + "TroChoi/api/update",
                        type: "POST",
                        contentType: "application/json",
                        data: JSON.stringify(updatingObj),
                        success: function (responseData) {
                            // debugger;
                            if (responseData.status == 200 && responseData.message === "SUCCESS") {
                                Swal.fire(
                                    'Thành Công!',
                                    'Đã cập nhật \"' + objName + '\" ',
                                    'success'
                                );
                                updateTableTroChoi(id, updatingObj, "update");
                                var updatedItemIndex = dataSource.findIndex(item => parseInt(item.id) === id);
                                dataSource[updatedItemIndex] = updatingObj;
                            }
                        },
                        error: function (e) {
                            //console.log(e.message);
                            Swal.fire(
                                'Lỗi!',
                                'Đã xảy ra lỗi, vui lòng thử lại',
                                'error'
                            );
                        }
                    });
                };

                //CALL AJAX TO CREATE
                if (id == 0) {
                    updatingObj.id = 1;
                    console.log(updatingObj);
                    $.ajax({
                        url: systemURL + "TroChoi/api/add",
                        type: "POST",
                        contentType: "application/json",
                        data: JSON.stringify(updatingObj),
                        success: function (responseData) {
                            // debugger;
                            if (responseData.status == 201 && responseData.message === "CREATED") {
                                Swal.fire(
                                    'Thành công!',
                                    'Đã cập nhật dữ liệu',
                                    'success'
                                );
                                updatingObj = responseData.data;
                                dataSourceTroChoi.push(updatingObj);
                                updateTableTroChoi(0, updatingObj, "add");
                            }
                        },
                        error: function (e) {
                            //console.log(e.message);
                            Swal.fire(
                                'Lỗi!',
                                'Đã xảy ra lỗi, vui lòng thử lại',
                                'error'
                            );
                        }
                    });
                }
            }
        })
    }
    function getItemByIDTroChoi(id) {
        const result = dataSource.find(item => item.maNv === id);
        return result;
    }
    function updateTableTroChoi(id, obj, action) {
        if (action === "delete") {
            table.row("#row" + id).remove().draw();
        }

        if (action === "add") {
            console.log("Added:" + obj);

            //var addedItems = [obj];
            var addedItems = obj;
            var addedValues = [];


            addedItems.forEach(function (item, index) {
                // console.log(item, index);
                var rowContent = "";
                addedValues.push("<td style='text-align: center;'></td>");
                for (var key in item) {
                    if (item.hasOwnProperty(key)) {
                        // console.log(key + " -> " + item[key]);
                        if (!hiddenItem.includes(key)) {
                            addedValues.push("<td class='row" + item.id + "-column column-" + key + "' property='" + key + "'>" + item[key] + "</td>");
                        }
                    }
                }

                addedValues.push("<td style='text-align: center;'><a href='/postTopic/admin/list/" + item.id + "'><i class='fa fa-list fa-2x' style='color:#03a9f4'></i></a></td>");
                addedValues.push("<td style='text-align: center;'><a onclick='editItem(" + item.id + ")'><i class='fa fa-edit fa-2x' style='color:#03a9f4'></i></a></td>");
                addedValues.push("<td style='text-align: center;'><a onclick='deleteItem(" + item.id + ")'><i class='fa fa-trash fa-2x' style='color:#e91e63'></i></a></td>");

                table.row.add(addedValues).draw();
            });
            // location.reload();
        }

        if (action === "update") {
            // alert(id);
            $(".row" + id + "-column").each(function () {
                var propertyName = $(this).attr("property");
                console.log(propertyName);

                for (var key in obj) {
                    if (key === propertyName && obj.hasOwnProperty(key)) {
                        this.innerText = obj[key];
                    }
                }

            });
        }

        //Update columns with foreign key
        // var NO_FKFKUpdateSelector = 'tr';
        // if( !(typeof(id) === 'undefined')) {
        //     NO_FKFKUpdateSelector = '#row'+id;
        // }
        // $('#tableData tbody '+NO_FKFKUpdateSelector+' td[property=NO_FKID]').each(function(){
        //     // debugger;
        //     var topicID = parseInt($(this).attr('class').replace('row','').replace('-column',''));
        //     var topicObj = getItemByID(topicID);
        //     var NO_FKID = parseInt(topicObj.NO_FKID);
        //     var NO_FKObj = NO_FKData.find(item => parseInt(item.id) === NO_FKID);
        //     $(this).text(NO_FKObj.name);
        //     // console.log('FK updated for Staff '+topicID);
        // });


        //formatNumber();
    }
    function deleteItemTroChoi(id) {
        debugger;
        let obj = getItemByIDTroChoi(id);
        Swal.fire({
            title: 'Xác nhận thay đổi?',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#3085d6',
            confirmButtonText: 'Xoá',
            cancelButtonText: 'Huỷ'
        }).then((result) => {
            if (result.value) {

                //CALL AJAX TO DELETE
                $.ajax({
                    url: systemURL + "TroChoi/api/delete",
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify({ "maKhu": id }),
                    success: function (responseData) {
                        debugger;
                        if (responseData.status == 200 && responseData.message === "SUCCESS") {
                            Swal.fire(
                                'Thành công!',
                                'success'
                            );
                            window.location.reload();
                        }
                    },
                    error: function (e) {
                        //console.log(e.message);
                        Swal.fire(
                            'Lỗi!',
                            'Đã xảy ra lỗi, vui lòng thử lại',
                            'error'
                        );
                    }
                });

            }
        })
    }


</script>
